<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Video Wall Command Center</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    #grid {
      display: grid;
      height: 100vh;
      width: 100vw;
      gap: 2px;
    }

    .iframe-wrapper {
      width: 100%;
      height: 100%;
      background: #fff;
      border: 1px dashed rgba(0,0,0,0.3);
      position: relative;
    }

    iframe, img {
      width: 100%;
      height: 100%;
      border: none;
      object-fit: cover;
    }

    .resizer-col, .resizer-row {
      position: absolute;
      background: rgba(255, 255, 255, 0.4);
      z-index: 10;
    }

    .resizer-col {
      width: 6px;
      top: 0;
      bottom: 0;
      right: -3px;
      cursor: col-resize;
    }

    .resizer-row {
      height: 6px;
      left: 0;
      right: 0;
      bottom: -3px;
      cursor: row-resize;
    }
  </style>
</head>
<body>

<div id="grid"></div>

<script>
  const grid = document.getElementById('grid');
  let layoutData = [];

  const loadSettings = async () => {
    const res = await fetch('layout.json');
    layoutData = await res.json();
    renderGrid();
  };

  const renderGrid = () => {
    grid.innerHTML = '';

    const colSizes = JSON.parse(localStorage.getItem('colSizes')) || Array(6).fill('1fr');
    const rowSizes = JSON.parse(localStorage.getItem('rowSizes')) || Array(3).fill('1fr');

    grid.style.gridTemplateColumns = colSizes.join(' ');
    grid.style.gridTemplateRows = rowSizes.join(' ');

    layoutData.forEach((item, index) => {
      const wrapper = document.createElement('div');
      wrapper.classList.add('iframe-wrapper');
      wrapper.style.gridColumn = `${item.col} / span ${item.colSpan}`;
      wrapper.style.gridRow = `${item.row} / span ${item.rowSpan}`;

      if (item.type === "image") {
        const img = document.createElement('img');
        img.src = item.url;
        wrapper.appendChild(img);
      } else {
        const iframe = document.createElement('iframe');
        iframe.src = item.url;
        wrapper.appendChild(iframe);
      }

      // Only add resizers if it's the edge of a column or row
      if (item.col + item.colSpan - 1 < 6) {
        const resizerCol = document.createElement('div');
        resizerCol.classList.add('resizer-col');
        resizerCol.dataset.col = item.col + item.colSpan - 1;
        wrapper.appendChild(resizerCol);
        addColResizeHandler(resizerCol);
      }

      if (item.row + item.rowSpan - 1 < 3) {
        const resizerRow = document.createElement('div');
        resizerRow.classList.add('resizer-row');
        resizerRow.dataset.row = item.row + item.rowSpan - 1;
        wrapper.appendChild(resizerRow);
        addRowResizeHandler(resizerRow);
      }

      grid.appendChild(wrapper);
    });
  };

  const addColResizeHandler = (handle) => {
    handle.addEventListener('mousedown', (e) => {
      e.preventDefault();
      const colIndex = parseInt(handle.dataset.col);
      const startX = e.clientX;
      const colSizes = JSON.parse(localStorage.getItem('colSizes')) || Array(6).fill('1fr');
      const gridWidth = grid.offsetWidth;
      const currentSize = grid.getBoundingClientRect().width * parseFloat(getComputedStyle(grid).gridTemplateColumns.split(' ')[colIndex - 1].replace('fr','')) / gridWidth;

      const onMouseMove = (e) => {
        const delta = e.clientX - startX;
        const px = Math.max(50, currentSize + delta);
        colSizes[colIndex - 1] = px + 'px';
        localStorage.setItem('colSizes', JSON.stringify(colSizes));
        renderGrid();
      };

      const onMouseUp = () => {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      };

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    });
  };

  const addRowResizeHandler = (handle) => {
    handle.addEventListener('mousedown', (e) => {
      e.preventDefault();
      const rowIndex = parseInt(handle.dataset.row);
      const startY = e.clientY;
      const rowSizes = JSON.parse(localStorage.getItem('rowSizes')) || Array(3).fill('1fr');
      const gridHeight = grid.offsetHeight;
      const currentSize = grid.getBoundingClientRect().height * parseFloat(getComputedStyle(grid).gridTemplateRows.split(' ')[rowIndex - 1].replace('fr','')) / gridHeight;

      const onMouseMove = (e) => {
        const delta = e.clientY - startY;
        const px = Math.max(50, currentSize + delta);
        rowSizes[rowIndex - 1] = px + 'px';
        localStorage.setItem('rowSizes', JSON.stringify(rowSizes));
        renderGrid();
      };

      const onMouseUp = () => {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      };

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    });
  };

  loadSettings();
</script>
</body>
</html>